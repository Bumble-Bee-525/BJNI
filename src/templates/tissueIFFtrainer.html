<!DOCTYPE html>
<html>
  <head>
    <!--Basic Settings-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, intial-scale=1">
    
    <!--Title and Favicon-->
    <title>Tissue ID Trainer</title>
    <link rel="icon" type="image/x-icon" href="../static/images/favicon.png">
    
    <!--Bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  
    <!--Custom css for tissue image and container-->
    <style>
        .tissueWrapper {
            overflow: hidden;
            width: 30vw;
            height: 30vw;
            margin: auto;
            border: 0.25rem solid black;
            border-radius: 50%;
        }
    </style>
  </head>
  <body>
    <!--Navbar-->
    <nav class="navbar navbar-expand-lg" style="background-color: #e3f2fd;">
      <div class="container-fluid">
        <!--Logo-->
        <a class="navbar-brand" href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">
          <img src="../static/images/logoBJ.png" width="auto" style="height: 4rem;">
        </a>
        <!--Toggle button for small devices-->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-expanded="false">
          <span class="navbar-toggler-icon"></span>
        </button>
        <!--Searchbar for NCBI-->
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
          <div class="navbar-nav">
            <a class="nav-link mx-2" href="/templates/about.html">About us</a>
            <a class="nav-link mx-2" href="/">Home</a>
          </div>
        </div>
      </div>
    </nav>
    <br>
    
    <!--Box for tissue image-->
    <div id="wrapper" class="tissueWrapper">
        <img id="unknownTissue" alt="Loading. . .">
    </div>
    
    <!--Box for controls-->
    <div style="justify-content: center; display: grid;" class="mt-3 mb-5">
        <h2 id="userAnswer">Your answer: </h2>
        <h2 id="key">Correct answer: </h2>
        <h2 id="score">Score: </h2>
        <button class="btn btn-primary" style="margin: auto" onclick="imageSelector()">Generate New Tissue Slide</button>
        <div class="btn-group mt-3" role="group">
            <button type="button" class="btn btn-info" onclick="select('thinSkin')">Thin Skin</button>
            <button type="button" class="btn btn-info" onclick="select('thickSkin')">Thick Skin</button>
            <button type="button" class="btn btn-info" onclick="select('thymus')">Thymus</button>
            <button type="button" class="btn btn-info" onclick="select('lymphNode')">Lymph Node</button>
            <button type="button" class="btn btn-info" onclick="select('tonsil')">Tonsil</button>
            <button type="button" class="btn btn-info" onclick="select('spleen')">Spleen</button>
            <button type="button" class="btn btn-info" onclick="select('peyersPatch')">Peyers Patch</button>
        </div>
        <button id="check" type="button" class="btn btn-success mt-3" onclick="check()">Check Answer</button>
    </div><br><br>
    
    <!--script that controls everything-->
    <script>
        const img = document.getElementById("unknownTissue")
        const container = document.getElementById("wrapper")
        var randomTissue = "bruh"
        var userAnswer = ""
        var total = 0;
        var correct = 0;
        
        function convertNames(name)
        {
            newName = name[0].toUpperCase();
            for (let i = 1; i < name.length; i++)
            {
                if (name[i] == name[i].toUpperCase())
                {
                    newName += " "
                }
                newName += name[i]
            }
            return newName
        }
        
        //randomly rotates image and crops random part
        function imageScrambler()
        {
            //This part crops the image randomly
            const s = 30;
            //reset everything
            img.style.marginLeft = "0vw";
            img.style.marginTop = "0vw";
            
            if (img.naturalHeight < img.naturalWidth)
            {
                //Set maximum and minimums for random translation, we're gonna assume the very left and right side of the images look kinda trash
                moveMin = 0;
                moveMax = (img.naturalWidth / img.naturalHeight) * s - s;
                
                //resize image to fit into circle
                img.style.height = s + "vw";
                img.style.width = (moveMax + s) + "vw";
                
                //move the image randomly by some amount
                move = Math.floor(Math.random() * (moveMax - moveMin)) + moveMin;
                img.style.marginLeft = "-" + move + "vw";
                
                //print debugging info
                console.log("translated left: " + move + "vw");
                console.log(moveMax);
                console.log(moveMin);
            }
            else
            {
                //Set maximum and minimums for random translation
                moveMin = 0
                moveMax = (img.naturalHeight / img.naturalWidth) * s - s;
                
                //resize image to fit into circle
                img.style.width = s + "vw";
                img.style.height = (moveMax + s) + "vw";
                
                //move the image randomly by some amount
                move = Math.floor(Math.random() * (moveMax - moveMin)) + moveMin;
                img.style.marginTop = "-" + move + "vw";
                
                //print debugging info
                console.log("translated down: " + move + "vw");
                console.log(img.width + " " + img.height);
                console.log(moveMax);
                console.log(moveMin);
            }
            
            //rotate image randomly
            theta = Math.floor(Math.random() * 360);
            container.style.rotate = theta + "deg";
            img.style.display = "inline-block"
            
            //debug info
            console.log("rotated: " + theta + "degrees")
        }
        
        img.onload = imageScrambler;
        
        //selects a random tissue and image
        function imageSelector()
        {
            //must all be pngs, must be from 0 to len
            tissues = [
                {"name": "thickSkin", "len": 5},
                {"name": "thinSkin", "len": 5},
                {"name": "thymus", "len": 5},
                {"name": "lymphNode", "len": 5},
                {"name": "tonsil", "len": 5},
                {"name": "spleen", "len": 5},
                {"name": "peyersPatch", "len": 5}
            ];
            
            //select a random tissue
            random = Math.floor(Math.random() * tissues.length);
            randomTissue = tissues[random]
            
            //select a random image of that tissue
            randImage = randomTissue.name + Math.floor(Math.random() * randomTissue.len);
            img.style.display = "none";
            img.src = "/static/images/tissues/" + randImage + ".png";
            
            console.log(img.src);
            
            document.getElementById("userAnswer").innerHTML = "Your answer: ";
            document.getElementById("key").innerHTML = "Correct answer: ";
            document.getElementById("check").removeAttribute("disabled")
            total++;
        }
        
        function select(tissue)
        {
            document.getElementById("userAnswer").innerHTML = "Your answer: " + convertNames(tissue);
            userAnswer = tissue;
        }
        
        function score()
        {
            document.getElementById("score").innerHTML = "Score: " + ((correct / total) * 100).toFixed(2) + "% (" + correct + "/" + total + ")";
        }
        
        function check()
        {
            if (userAnswer == randomTissue.name)
            {
                document.getElementById("userAnswer").innerHTML = "Your answer: " + convertNames(userAnswer) + " ✅";
                correct++;
            }
            else
            {
                document.getElementById("userAnswer").innerHTML = "Your answer: " + convertNames(userAnswer) + "❌";
            }
            document.getElementById("key").innerHTML = "Correct answer: " + convertNames(randomTissue.name)
        
            document.getElementById("check").setAttribute("disabled", "")
            score()
        }
        
        imageSelector()
        
    </script>
    <!--Bootstrap-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </body>
</html>